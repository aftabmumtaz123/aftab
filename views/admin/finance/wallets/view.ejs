<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <!-- Wallet Overview Card -->
    <div class="lg:col-span-1">
        <div class="bg-white rounded-3xl p-6 text-white relative overflow-hidden shadow-xl mb-6" 
             style="background: linear-gradient(135deg, <%= wallet.color || '#3b82f6' %> 0%, <%= wallet.color ? wallet.color + 'dd' : '#1d4ed8' %> 100%);">
            
            <div class="absolute top-0 right-0 w-48 h-48 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-3xl"></div>
            <div class="absolute bottom-0 left-0 w-40 h-40 bg-black/10 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>
            
            <div class="relative z-10 flex flex-col h-full justify-between min-h-[200px]">
                <div class="flex justify-between items-start">
                    <div class="flex flex-col">
                        <span class="text-white/80 text-xs font-medium tracking-wider uppercase"><%= wallet.type %></span>
                        <h4 class="font-bold text-2xl tracking-wide"><%= wallet.name %></h4>
                    </div>
                    <i class="fas fa-wifi text-white/50 rotate-90 text-xl"></i>
                </div>

                <div class="flex items-center gap-3 my-4">
                    <div class="w-12 h-9 bg-yellow-200/80 rounded-md flex items-center justify-center overflow-hidden relative shadow-sm">
                        <div class="absolute w-full h-[1px] bg-black/20 top-1/3"></div>
                        <div class="absolute w-full h-[1px] bg-black/20 bottom-1/3"></div>
                        <div class="absolute h-full w-[1px] bg-black/20 left-1/3"></div>
                        <div class="absolute h-full w-[1px] bg-black/20 right-1/3"></div>
                    </div>
                    <i class="fas fa-rss text-2xl text-white/80 rotate-90"></i>
                </div>

                <div>
                    <p class="text-sm text-white/80 mb-2 font-mono tracking-widest">**** **** **** <%= wallet._id.toString().slice(-4) %></p>
                    <div class="flex justify-between items-end">
                        <h3 class="text-4xl font-bold tracking-tight shadow-black drop-shadow-md"><%= wallet.currency %> <%= wallet.balance.toLocaleString() %></h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6">
            <h4 class="font-bold text-gray-800 mb-3">Quick Actions</h4>
            <div class="grid grid-cols-2 gap-3">
                <a href="/admin/finance/wallets/transfer?from=<%= wallet._id %>" class="flex flex-col items-center justify-center p-3 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors">
                    <i class="fas fa-paper-plane mb-1"></i>
                    <span class="text-xs font-medium">Transfer</span>
                </a>
                <a href="/admin/finance/wallets/edit/<%= wallet._id %>" class="flex flex-col items-center justify-center p-3 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100 transition-colors">
                    <i class="fas fa-edit mb-1"></i>
                    <span class="text-xs font-medium">Edit</span>
                </a>
            </div>
        </div>

        <!-- Balance Chart -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <h4 class="font-bold text-gray-800 mb-4">Balance History</h4>
            <div class="h-48">
                <canvas id="balanceChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Transaction History -->
    <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center">
                <h3 class="font-bold text-gray-800">Transaction History</h3>
                <span class="text-xs text-gray-500"><%= history.length %> transactions</span>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gray-50 text-gray-500 font-medium">
                        <tr>
                            <th class="px-6 py-3">Date</th>
                            <th class="px-6 py-3">Description</th>
                            <th class="px-6 py-3">Type</th>
                            <th class="px-6 py-3 text-right">Amount</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <% history.forEach(item => { %>
                            <tr class="hover:bg-gray-50 transition-colors">
                                <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                                    <%= new Date(item.date).toLocaleDateString() %>
                                </td>
                                <td class="px-6 py-4">
                                    <p class="font-medium text-gray-900">
                                        <%= item.title || item.source || item.description || item.notes || 'Transaction' %>
                                    </p>
                                    <% if (item.category) { %>
                                        <span class="text-xs text-gray-400"><%= item.category %></span>
                                    <% } %>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="px-2 py-1 rounded-full text-xs font-medium
                                        <%= item.type.includes('expense') || item.type.includes('sent') ? 'bg-red-100 text-red-600' : 'bg-green-100 text-green-600' %>">
                                        <%= item.type.replace('_', ' ').toUpperCase() %>
                                    </span>
                                </td>
                                <td class="px-6 py-4 text-right font-bold <%= item.amount < 0 ? 'text-red-600' : 'text-green-600' %>">
                                    <%= item.amount < 0 ? '-' : '+' %> Rs <%= Math.abs(item.amount).toLocaleString() %>
                                </td>
                            </tr>
                        <% }) %>
                        <% if (history.length === 0) { %>
                            <tr>
                                <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                                    No transactions found for this wallet.
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const chartPoints = <%- JSON.stringify(chartPoints) %>;
        
        const ctx = document.getElementById('balanceChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartPoints.map(p => new Date(p.date).toLocaleDateString()),
                datasets: [{
                    label: 'Balance',
                    data: chartPoints.map(p => p.balance),
                    borderColor: '<%= wallet.color || "#3b82f6" %>',
                    backgroundColor: '<%= wallet.color ? wallet.color + "20" : "#3b82f620" %>',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: false, grid: { display: false } },
                    x: { display: false }
                }
            }
        });
    });
</script>
